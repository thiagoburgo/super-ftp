name: 'Setup Node with Clean'
description: 'Setup Node.js and clean npm cache/config to avoid authentication issues'

runs:
  using: 'composite'
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version-file: '.nvmrc'
    
    - name: Clean npm cache and config
      shell: bash
      run: |
        echo "ðŸ§¹ Cleaning npm cache and config..."
        
        # Limpar cache
        npm cache clean --force
        
        # Remover configuraÃ§Ãµes globais do usuÃ¡rio
        # O arquivo .npmrc do projeto serÃ¡ preservado e usado
        rm -f ~/.npmrc || true
        rm -f /home/runner/.npmrc || true
        rm -f /root/.npmrc || true
        
        # Verificar qual registry serÃ¡ usado (deve vir do .npmrc do projeto)
        echo "ðŸ“‹ Registry configurado: $(npm config get registry)"
        
        echo "âœ… npm cache and config cleaned"

